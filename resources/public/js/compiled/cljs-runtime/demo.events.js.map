{"version":3,"sources":["demo/events.cljs"],"mappings":";AASA,yDAAA,zDAACA,oJAEA,EAAA,AAAAC,iDAAA,WAAYO,EAAEA;AAAd,AAAA,IAAAN,6BAAA;AAAA,AAAA,IAAA,AAAA,AAAAC,gDAAA,AAAA;;AAAA,IAAAC,wBACEK;AADF,AAAA,AAAAJ,iDAAA,2CAAA,8DAAA,EAAA,qEAAA,IAAA,yDAAAD,sBAAA,sDAAA,AAAA,yEAAA,qEAAA;;AAAAA;gBAAA,IAAAE,IAAAC;AAAA,AAAA,MAAAD;IAAA,WAAYE,EAAEA;AAAd,AACEC;;AAEH,sBAAA,tBAAMC;AAAN,mDACM,AAAA,AAAIC,AACJ,2BAAA,9EACA,mFAAA,5EAACC;;AAEP,yDAAA,zDAACZ,8JAEA,WAAKa,GAAGL;AAAR,AACE,wDAAA,jDAACM,8CAAMD,0DAAW,oHAAA,2CAAA,iEAAA,WAAAE,3OAACC,qBAAU,CAAA,4EAAA,vBAAc,AAACN;AAA1B,AACyB,8BAAA,mFAAA,8FAAAK,xMAACE;;;AAC/C,yDAAA,zDAACjB,4IAEA,WAAKa,GAAGL;AAAR,AACE,wDAAA,4DAAA,7GAACM,8CAAMD;;AAEV,yDAAA,zDAACb,uJAEA,cAAAkB,HAAKL;AAAL,AAAA,IAAAM,aAAAD;QAAA,AAAAN,4CAAAO,WAAA,IAAA,/DAASX;UAAT,AAAAI,4CAAAO,WAAA,IAAA,jEAAWC;AAAX,AACC,IAAMC,MAAI,AAACC,sDAAwB,AAAQF;AAA3C,AACE,oBAAI,AAAA,wFAASC;AACT,wDAAA,jDAACP,8CAAMD,uEAAgBQ;;AACvB,oBAAI,AAAA,kFAAMA;AACN,GAAI,oIAAA,pIAACE,6CAAE,AAAA,kFAAMF;oGACLR,9CACA,iDAAA,4DAAA,7GAACC,tDACD,yKAAA,lKAACU;;AACL,wDAAA,jDAACV,8CAAMD,4DAAW,AAAA,kFAAMQ;;;iMAC1BR,9CACF,iDAAA,jDAACC,0GAAc,kDAAA,LAAKO,tMACpB,gOAAA,hOAACG,/CACD,uUAAA,vUAACA,rDACD,icAAA,4DAAA,tfAACV;;;;AAEb,yDAAA,zDAACd,kJAEA,cAAAyB,HAAKZ;AAAL,AAAA,IAAAa,aAAAD;QAAA,AAAAb,4CAAAc,WAAA,IAAA,/DAASlB;UAAT,AAAAI,4CAAAc,WAAA,IAAA,jEAAWL;AAAX,AACE,wDAAA,jDAACP,8CAAMD,wDAAS,AAACc,eAAK,2BAAA,3BAAQ,AAAA,AAAIhB;;AAErC,yDAAA,zDAACX,kJAEA,cAAA4B,HAAKf;AAAL,AAAA,IAAAgB,aAAAD;QAAA,AAAAhB,4CAAAiB,WAAA,IAAA,/DAASrB;UAAT,AAAAI,4CAAAiB,WAAA,IAAA,jEAAWR;AAAX,AACE,wDAAA,jDAACP,8CAAMD,2DAAUQ;;AAEpB,yDAAA,zDAACS,qIAEA,WAAAC,SAAAC;AAAA,AAAA,IAAAC,aAAAF;IAAAE,iBAAA,AAAAC,4BAAAD;SAAA,AAAAE,4CAAAF,eAAA,hEAAapB;IAAbuB,aAAAJ;QAAA,AAAApB,4CAAAwB,WAAA,IAAA,/DAAmB5B;UAAnB,AAAAI,4CAAAwB,WAAA,IAAA,jEAAqBC;AAArB,AACE,OAACC,iDAAQ,AAAA,qFAASzB,IAAIwB","names":["re_frame.core.reg_event_db","day8.re-frame.tracing/is-trace-enabled?","+debux-dbg-opts+","day8.re-frame.debux.common.util/send-form!","result__29532__auto__","day8.re-frame.debux.common.util/send-trace!","e","e29779","_","demo.db/default-db","demo.events/address","js/window","cljs.core.nth","db","cljs.core.assoc","p1__29780#","wscljs.client/create","re-frame.core/dispatch","p__29781","vec__29782","msg","val","cljs.reader.read_string","cljs.core._EQ_","cljs.core.dissoc","p__29785","vec__29786","cljs.core/rest","p__29789","vec__29790","re_frame.core.reg_event_fx","p__29793","p__29794","map__29795","cljs.core/--destructure-map","cljs.core.get","vec__29796","pos","wscljs.client.send"],"sourcesContent":["(ns demo.events\r\n  (:require\r\n   [re-frame.core :as re-frame]\r\n   [demo.db :as db]\r\n   [day8.re-frame.tracing :refer-macros [fn-traced]]\r\n   [wscljs.client :as ws]\r\n   [wscljs.format :as fmt]\r\n   ))\r\n\r\n(re-frame/reg-event-db\r\n ::initialize-db\r\n (fn-traced [_ _]\r\n   db/default-db))\r\n\r\n(defn address []\r\n  (-> (.. js/window -location -href)\r\n      (.split \"/\")\r\n      (nth 2)))\r\n\r\n(re-frame/reg-event-db\r\n ::connect-websocket\r\n (fn [db _]\r\n   (assoc db :socket (ws/create (str \"wss://\" (address) \"/game\")\r\n                                {:on-message #(re-frame/dispatch [::update-handler %])}))))\r\n(re-frame/reg-event-db\r\n ::open-con\r\n (fn [db _]\r\n   (assoc db :in-game true)))\r\n\r\n(re-frame/reg-event-db\r\n ::update-handler\r\n (fn [db [_ msg]]\r\n  (let [val (cljs.reader/read-string (.-data msg))]\r\n    (if (:status val)\r\n        (assoc db :gamemarkers val)\r\n        (if (:msg val)\r\n            (if (= (:msg val) \"Let the game begin!\")\r\n                (-> db\r\n                    (assoc :in-game true)\r\n                    (dissoc :result))\r\n                (assoc db :result (:msg val)))\r\n          (-> db\r\n            (assoc :result (str val \" WIN!!!\"))\r\n            (dissoc :socket)\r\n            (dissoc :gamemarkers)\r\n            (assoc :in-game false)))))))\r\n\r\n(re-frame/reg-event-db\r\n ::update-name\r\n (fn [db [_ val]]\r\n   (assoc db :name (rest (.split (.. js/window -location -href) \"/\")))))\r\n\r\n(re-frame/reg-event-db\r\n ::search-field\r\n (fn [db [_ val]]\r\n   (assoc db :field val)))\r\n\r\n(re-frame/reg-event-fx\r\n ::shoot\r\n (fn [{:keys [db]} [_ pos]]\r\n   (ws/send (:socket db) pos)))\r\n"]}